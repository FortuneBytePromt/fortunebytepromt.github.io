<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ˜“ç¶“æ²è“æ³•å°ˆé  | Fortune Byte</title>
  <style>
    body { font-family: "Noto Sans TC", sans-serif; background: #f5f7fa; padding: 30px; }
    .output { background: #fffaf0; border: 1px solid #e0e0e0; padding: 20px; border-radius: 10px; margin-top: 20px; }
    button { padding: 10px 20px; border-radius: 20px; border: none; background: #3498db; color: #fff; font-size: 1em; cursor: pointer; }
    button:hover { background: #2980b9; }
    .section { background: white; padding: 25px; margin-bottom: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    h2 { margin-top: 0; }
  </style>
  <script src="64gua.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5479456509868941"
    crossorigin="anonymous"></script>
</head>
<body>
  <h1>ğŸŒ¿ æ˜“ç¶“æ²è“æ³•å°ˆé </h1>
  <div class="section">
    <h2>è‡ªå‹•ç”¢ç”Ÿä¸€å¦</h2>
    <div class="input-group">
      <label for="question">è«‹è¼¸å…¥ä½ çš„åœå¦å•é¡Œï¼š</label>
      <textarea id="question" rows="2" style="width:100%;max-width:400px;"></textarea>
    </div>
    <button onclick="generateYarrowHexagram()">ğŸ”® è‡ªå‹•ç”¢ç”Ÿä¸€å¦</button>
    <div id="yarrowResult" class="output"></div>
    <details style="margin-top:20px;">
      <summary style="font-weight:bold;cursor:pointer;">é»æ­¤å±•é–‹æ²è“æ³•è©³ç´°æ­¥é©Ÿèªªæ˜</summary>
      <div style="margin-top:10px;text-align:left;">
        <h3>1. è“è‰æº–å‚™ï¼šæ•¸é‡èˆ‡é å‚™</h3>
        <p>å‚³çµ±ã€Šæ˜“ç¶“ã€‹ç­®å¦æ¡ç”¨è“è‰è–ä½œç‚ºå·¥å…·ï¼Œä¸€èˆ¬éœ€è¦æº–å‚™ <b>50æ ¹è“è‰</b>ã€‚æ­£å¼èµ·å¦æ™‚å…ˆå°‡50æ ¹è“è‰å–å‡º1æ ¹ä¸ç”¨ï¼Œç•™ä¸‹ <b>49æ ¹</b> ä½œç‚ºç­®ç®—ä¹‹ç”¨ã€‚ç­®å‰éœå¿ƒå‡ç¥ï¼Œä»¥ç¤ºå°å åœéç¨‹çš„é‡è¦–ã€‚</p>
        <h3>2. "ä¸‰è®Š"æµç¨‹ï¼šåˆè®Šã€ä¸­è®Šã€çµ‚è®Š</h3>
        <ol>
          <li><b>åˆ†äºŒ</b>ï¼šå°‡49æ ¹è“è‰éš¨æ©Ÿåˆ†æˆå…©å †ï¼Œè±¡å¾µé™°é™½å…©å„€ã€‚</li>
          <li><b>æ›ä¸€</b>ï¼šå¾å³æ‰‹é‚£å †å–å‡º1æ ¹ï¼Œå¤¾æ–¼æŒ‡é–“ã€‚</li>
          <li><b>æ²å››</b>ï¼šåˆ†åˆ¥å°å·¦å³å…©å †é€²è¡Œ"å››æ ¹ä¸€æ•¸"çš„è¨ˆæ•¸ï¼Œå–å‡ºé¤˜æ•¸ï¼ˆè‹¥é¤˜æ•¸ç‚º0å‰‡è¦–ç‚º4ï¼‰ã€‚</li>
          <li><b>æ­¸å¥‡</b>ï¼šå°‡æ‰€æœ‰é¤˜æ•¸åˆä½µï¼Œè±¡å¾µ"æ­¸å¥‡æ–¼æ‰ä»¥è±¡é–"ã€‚</li>
        </ol>
        <p>å®Œæˆä¸€æ¬¡å››ç‡Ÿå¾Œï¼Œå¾åŸå…ˆ49æ ¹ä¸­å–èµ°4ã€5ã€8æˆ–9æ ¹ï¼Œå‰©é¤˜è“è‰å†é‡è¤‡ä¸‰æ¬¡ï¼Œç¨±ç‚º"ä¸‰è®Š"ã€‚</p>
        <h3>3. ä¸‰æ¬¡è®ŠåŒ–å®šçˆ»ï¼šçˆ»è±¡è¨ˆç®—èˆ‡åˆ¤è®€</h3>
        <p>ä¸‰è®Šå¾Œå‰©ä¸‹24ã€28ã€32æˆ–36æ ¹ï¼Œé™¤ä»¥4å¾—6ã€7ã€8ã€9ï¼Œåˆ†åˆ¥ä»£è¡¨è€é™°ã€å°‘é™½ã€å°‘é™°ã€è€é™½ã€‚å…­çˆ»ç”±ä¸‹å¾€ä¸Šæ’åˆ—ï¼Œç•«å¦æ™‚ä»¥"â€”"ç‚ºé™½ã€"--"ç‚ºé™°ï¼Œè€é™½â—‹ã€è€é™°Ã—æ¨™è¨˜ã€‚</p>
        <h3>4. å…­çˆ»æˆå¦ï¼šçµ„æˆæ•´é«”å¦è±¡</h3>
        <p>å…­çˆ»çš†ç¶“ä¸‰è®Šï¼Œå…±åå…«æ¬¡æ“ä½œï¼Œå¾—å…­å€‹çˆ»è±¡ï¼Œçµ„æˆæœ¬å¦ã€‚è‹¥æœ‰è®Šçˆ»ï¼ˆè€é™°ã€è€é™½ï¼‰ï¼Œå‰‡é™°é™½äº’æ›å¾—è®Šå¦ã€‚å¯åƒç…§å¦è¾­ã€çˆ»è¾­è§£è®€ã€‚</p>
      </div>
    </details>
  </div>
  <div class="section">
    <h2>é€²éšäº’å‹•æ²è“æ³•</h2>
    <div id="yarrowStepArea" class="output" style="margin-bottom:20px;"></div>
    <button id="yarrowStepBtn" onclick="yarrowStep()">é–‹å§‹ç¬¬ä¸€çˆ»ä¸‰è®Š</button>
    <button id="yarrowResetBtn" onclick="yarrowReset()" style="display:none;">é‡ç½®</button>
    <div id="yarrowAdvancedResult" class="output" style="margin-top:20px;"></div>
  </div>
  <script>
    // æ²è“æ³•ä¸‰è®Šæµç¨‹
    function yarrowThreeChanges() {
      let remain = 49;
      let steps = [];
      for (let i = 0; i < 3; i++) {
        let left = Math.floor(Math.random() * (remain - 1)) + 1;
        let right = remain - left;
        right -= 1;
        let leftRemain = left % 4; if (leftRemain === 0) leftRemain = 4;
        let rightRemain = right % 4; if (rightRemain === 0) rightRemain = 4;
        let remove = 1 + leftRemain + rightRemain;
        remain -= remove;
        steps.push(remove);
      }
      if (![24,28,32,36].includes(remain)) return yarrowThreeChanges();
      return {remain, steps, yao: remain/4};
    }

    // è‡ªå‹•ç”¢ç”Ÿä¸€å¦
    function generateYarrowHexagram() {
      const q = document.getElementById('question')?.value?.trim() || '';
      const yaoArr = [];
      for(let i=0;i<6;i++) {
        yaoArr.push(yarrowThreeChanges().yao);
      }
      let lines = yaoArr.slice();
      let changed = yaoArr.map(v=>v===6?7:v===9?8:v);
      let changePos = yaoArr.map((v,i)=>v===6||v===9?i+1:null).filter(x=>x);
      const baseInfo = getFullHexagramInfo(lines);
      const changedInfo = getFullHexagramInfo(changed);
      let html = `<b>æˆ‘æƒ³è¦åœå•çš„å•é¡Œæ˜¯ï¼š</b> ${q||'...'}<br>`;
      html += `<b>æœ¬å¦ï¼š</b> ${baseInfo.name}ï¼ˆ${baseInfo.number}ï¼‰<br>`;
      if(baseInfo.text) html += `<div style='color:#888;font-size:0.95em;'>å¦è¾­ï¼š${baseInfo.text}</div>`;
      html += `<b>è®Šå¦ï¼š</b> ${changedInfo.name}ï¼ˆ${changedInfo.number}ï¼‰<br>`;
      if(changedInfo.text) html += `<div style='color:#888;font-size:0.95em;'>å¦è¾­ï¼š${changedInfo.text}</div>`;
      let yaoNames = ['åˆ','äºŒ','ä¸‰','å››','äº”','ä¸Š'];
      let baseJsonKey = Object.keys(typeof guaData!=="undefined"?guaData:{}).find(k=>k.startsWith(String(baseInfo.number).padStart(2,'0')));
      let changedJsonKey = Object.keys(typeof guaData!=="undefined"?guaData:{}).find(k=>k.startsWith(String(changedInfo.number).padStart(2,'0')));
      let yaoKeys = Object.keys(guaData[baseJsonKey]?.['çˆ»è¾­'] || {});
      let changedYaoKeys = Object.keys(guaData[changedJsonKey]?.['çˆ»è¾­'] || {});
      html += getYaoTextBlock(changePos, baseInfo, changedInfo, guaData, baseJsonKey, changedJsonKey, yaoKeys, changedYaoKeys);
      let interpret = getInterpretText(changePos.length);
      document.getElementById('yarrowResult').innerHTML = html;
      // æ–°å¢ï¼šè‡ªå‹•ä¸Ÿçµ¦ ChatGPT
      const prompt = html.replace(/<[^>]+>/g, '\n');
      const url = `https://chat.openai.com/?prompt=${encodeURIComponent(prompt)}`;
      window.open(url, '_blank');
    }

    // é€²éšäº’å‹•æ²è“æ³•
    let yarrowStepCount = 0;
    let yarrowLines = [];
    function yarrowStep() {
      if (yarrowStepCount >= 6) return;
      const { remain, steps, yao } = yarrowThreeChanges();
      let stepHtml = `<b>ç¬¬${yarrowStepCount+1}çˆ»ï¼ˆä¸‰è®Šéç¨‹ï¼‰ï¼š</b><br>`;
      let left = 49;
      steps.forEach((remove, i) => {
        left -= remove;
        stepHtml += `ç¬¬${i+1}è®Šï¼šå»é™¤${remove}æ ¹ï¼Œå‰©${left}æ ¹<br>`;
      });
      stepHtml += `ä¸‰è®Šå¾Œå‰©${remain}æ ¹ï¼Œå¾—ï¼š<b>${yao}</b><br><hr>`;
      yarrowLines.push(yao);
      yarrowStepCount++;
      document.getElementById('yarrowStepArea').innerHTML += stepHtml;
      if (yarrowStepCount < 6) {
        document.getElementById('yarrowStepBtn').textContent = `é–‹å§‹ç¬¬${yarrowStepCount+1}çˆ»ä¸‰è®Š`;
      } else {
        document.getElementById('yarrowStepBtn').style.display = 'none';
        document.getElementById('yarrowResetBtn').style.display = '';
        showYarrowAdvancedResult();
      }
    }
    function yarrowReset() {
      yarrowStepCount = 0;
      yarrowLines = [];
      document.getElementById('yarrowStepArea').innerHTML = '';
      document.getElementById('yarrowStepBtn').textContent = 'é–‹å§‹ç¬¬ä¸€çˆ»ä¸‰è®Š';
      document.getElementById('yarrowStepBtn').style.display = '';
      document.getElementById('yarrowResetBtn').style.display = 'none';
      document.getElementById('yarrowAdvancedResult').innerHTML = '';
    }
    function showYarrowAdvancedResult() {
      const q = document.getElementById('question')?.value?.trim() || '';
      let changed = yarrowLines.map(v=>v===6?7:v===9?8:v);
      let changePos = yarrowLines.map((v,i)=>v===6||v===9?i+1:null).filter(x=>x);
      const baseInfo = getFullHexagramInfo(yarrowLines);
      const changedInfo = getFullHexagramInfo(changed);
      let html = `<b>æœ¬å¦ï¼š</b> ${baseInfo.name}ï¼ˆ${baseInfo.number}ï¼‰<br>`;
      if(baseInfo.text) html += `<div style='color:#888;font-size:0.95em;'>å¦è¾­ï¼š${baseInfo.text}</div>`;
      html += `<b>è®Šå¦ï¼š</b> ${changedInfo.name}ï¼ˆ${changedInfo.number}ï¼‰<br>`;
      if(changedInfo.text) html += `<div style='color:#888;font-size:0.95em;'>å¦è¾­ï¼š${changedInfo.text}</div>`;
      html += '<b>æœ¬å¦ï¼ˆç”±ä¸‹å¾€ä¸Šï¼‰ï¼š</b><br>';
      for(let i=5;i>=0;i--) html += yarrowLines[i]+'<br>';
      html += '<b>è®Šå¦ï¼ˆç”±ä¸‹å¾€ä¸Šï¼‰ï¼š</b><br>';
      for(let i=5;i>=0;i--) html += changed[i]+'<br>';
      html += '<b>å…­çˆ»çµæœï¼š</b> '+yarrowLines.join(', ')+'<br>';
      html += '<b>è®Šçˆ»ä½ç½®ï¼š</b> '+(changePos.length?changePos.join(', '):'ç„¡')+'<br>';
      html += '<small>ï¼ˆ6=è€é™°Ã—ï¼Œ7=å°‘é™½ï¼Œ8=å°‘é™°ï¼Œ9=è€é™½â—‹ï¼‰</small>';
      let yaoNames = ['åˆ','äºŒ','ä¸‰','å››','äº”','ä¸Š'];
      let baseJsonKey = Object.keys(typeof guaData!=="undefined"?guaData:{}).find(k=>k.startsWith(String(baseInfo.number).padStart(2,'0')));
      let changedJsonKey = Object.keys(typeof guaData!=="undefined"?guaData:{}).find(k=>k.startsWith(String(changedInfo.number).padStart(2,'0')));
      let yaoKeys = Object.keys(guaData[baseJsonKey]?.['çˆ»è¾­'] || {});
      let changedYaoKeys = Object.keys(guaData[changedJsonKey]?.['çˆ»è¾­'] || {});
      html += getYaoTextBlock(changePos, baseInfo, changedInfo, guaData, baseJsonKey, changedJsonKey, yaoKeys, changedYaoKeys);
      let interpret = getInterpretText(changePos.length);
      document.getElementById('yarrowAdvancedResult').innerHTML = html;
    }

    // å…±ç”¨ï¼šæ ¹æ“šè®Šçˆ»æ•¸é‡é¡¯ç¤ºçˆ»è¾­
    function getYaoTextBlock(changePos, baseInfo, changedInfo, guaData, baseJsonKey, changedJsonKey, yaoKeys, changedYaoKeys) {
      let html = '';
      if (changePos.length > 0) {
        html += `<div><b>è®Šçˆ»ï¼š</b>ç¬¬${changePos.join('ã€')}çˆ»</div>`;
      } else {
        html += `<div><b>è®Šçˆ»ï¼š</b>ç„¡</div>`;
      }
      
      if ([1,2,4,5].includes(changePos.length)) {
        html += `<div style='margin-top:8px;'><b>è®Šçˆ»çˆ»è¾­ï¼š</b><ul style='margin:0 0 0 18px;padding:0;'>`;
        if(changePos.length===2) {
          let mainIdx = Math.max(...changePos)-1;
          let subIdx = Math.min(...changePos)-1;
          html += `<li><b>ä¸»</b>ï¼šç¬¬${mainIdx+1}çˆ»ï¼š${guaData[baseJsonKey]?.['çˆ»è¾­'][yaoKeys[mainIdx]]||''}</li>`;
          html += `<li><b>è¼”</b>ï¼šç¬¬${subIdx+1}çˆ»ï¼š${guaData[baseJsonKey]?.['çˆ»è¾­'][yaoKeys[subIdx]]||''}</li>`;
        } else if(changePos.length===4) {
          let notChanged = [];
          for(let i=0;i<6;i++) if(!changePos.includes(i+1)) notChanged.push(i+1);
          let mainIdx = Math.min(...notChanged)-1;
          let subIdx = Math.max(...notChanged)-1;
          html += `<li><b>ä¸»</b>ï¼šç¬¬${mainIdx+1}çˆ»ï¼š${guaData[changedJsonKey]?.['çˆ»è¾­'][changedYaoKeys[mainIdx]]||''}</li>`;
          html += `<li><b>è¼”</b>ï¼šç¬¬${subIdx+1}çˆ»ï¼š${guaData[changedJsonKey]?.['çˆ»è¾­'][changedYaoKeys[subIdx]]||''}</li>`;
        } else if(changePos.length===5) {
          let notChanged = [];
          for(let i=0;i<6;i++) if(!changePos.includes(i+1)) notChanged.push(i+1);
          let idx = notChanged[0]-1;
          html += `<li>ç¬¬${idx+1}çˆ»ï¼š${guaData[changedJsonKey]?.['çˆ»è¾­'][changedYaoKeys[idx]]||''}</li>`;
        } else if(changePos.length===1) {
          let idx = changePos[0]-1;
          html += `<li>ç¬¬${idx+1}çˆ»ï¼š${guaData[baseJsonKey]?.['çˆ»è¾­'][yaoKeys[idx]]||''}</li>`;
        }
        
        html += `</ul></div>`;
      }
      html += `<div style='margin-top:8px;'><b>åˆ¤è®€æ–¹å¼ï¼š</b>${getInterpretText(changePos.length)}</div>`;
      return html;
    }
    // å…±ç”¨ï¼šæ ¹æ“šè®Šçˆ»æ•¸é‡çµ¦å‡ºè§£è®€å»ºè­°
    function getInterpretText(changePosLength) {
      switch(changePosLength) {
        case 0:
          return 'å…­çˆ»ä¸è®Šï¼šä»¥æœ¬å¦å¦è¾­ç‚ºä¸»ï¼Œä»£è¡¨å±€å‹¢ç©©å®šã€‚';
        case 1:
          return 'ä¸€çˆ»è®Šï¼šä»¥æœ¬å¦çš„è®Šçˆ»çˆ»è¾­ç‚ºä¸»ï¼Œæç¤ºç•¶ä¸‹é—œéµã€‚';
        case 2:
          return 'äºŒçˆ»è®Šï¼šä»çœ‹æœ¬å¦ï¼Œä»¥ä¸Šçˆ»ç‚ºä¸»ï¼Œä¸‹çˆ»ç‚ºè¼”ã€‚';
        case 3:
          return 'ä¸‰çˆ»è®Šï¼šä»¥è®Šå¦å¦è¾­ç‚ºä¸»ï¼Œæœ¬å¦ç‚ºåƒè€ƒã€‚';
        case 4:
          return 'å››çˆ»è®Šï¼šçœ‹è®Šå¦ä¸­æœªè®Šçš„ä¸‹çˆ»çˆ»è¾­ï¼Œè¼”ä»¥ä¸Šçˆ»ã€‚';
        case 5:
          return 'äº”çˆ»è®Šï¼šå–è®Šå¦ä¸­å”¯ä¸€ä¸è®Šä¹‹çˆ»ç‚ºä¸»ã€‚';
        case 6:
          return 'å…­çˆ»çš†è®Šï¼šä¹¾ç”¨ã€Œç”¨ä¹ã€ã€å¤ç”¨ã€Œç”¨å…­ã€ï¼Œå…¶é¤˜å‰‡çœ‹è®Šå¦å¦è¾­ã€‚';
        default:
          return '';
      }
    }
    // å…±ç”¨ï¼šå–å¾—è®Šçˆ»ä½ç½®
    function getChangePos(lines) {
      return lines.map((v,i)=>v===6||v===9?i+1:null).filter(x=>x);
    }
    // å…±ç”¨ï¼šå–å¾—çˆ»åé™£åˆ—
    function getYaoNames() {
      return ['åˆ','äºŒ','ä¸‰','å››','äº”','ä¸Š'];
    }
    // å…±ç”¨ï¼šæœ¬å¦/è®Šå¦å€å¡Šé¡¯ç¤º
    function getHexagramBlock(info, label) {
      let html = `<b>${label}ï¼š</b> ${info.name}ï¼ˆ${info.number}ï¼‰<br>`;
      if(info.text) html += `<div style='color:#888;font-size:0.95em;'>å¦è¾­ï¼š${info.text}</div>`;
      return html;
    }
    // å–å¾—æ­£å¼å¦åã€å¦åºè™Ÿã€å¦è¾­çš„å…±ç”¨å‡½æ•¸
    function getFullHexagramInfo(lines) {
      // é€™è£¡å‡è¨­ lines ç‚º 6 å€‹æ•¸å­—ï¼ˆ6,7,8,9ï¼‰
      // è½‰æ›ç‚ºé™°é™½ï¼ˆ1=é™½ï¼Œ0=é™°ï¼‰
      const lowerBinary = lines.slice(0,3).map(v=>(v===7||v===9)?1:0).join('');
      const upperBinary = lines.slice(3,6).map(v=>(v===7||v===9)?1:0).join('');
      const trigramBinary = ['111','000','001','010','011','100','101','110'];
      const trigramNames = ['åœ°','å¤©','æ¾¤','ç«','é›·','é¢¨','æ°´','å±±'];
      const lowerIdx = trigramBinary.indexOf(lowerBinary);
      const upperIdx = trigramBinary.indexOf(upperBinary);
      const baseKey = (lowerIdx>-1 && upperIdx>-1) ? trigramNames[upperIdx]+trigramNames[lowerIdx] : null;
      let hexName = 'æœªçŸ¥', hexNum = '', hexText = '';
      if(baseKey && typeof hexagramsMapping!=="undefined" && hexagramsMapping[baseKey]) {
        hexName = hexagramsMapping[baseKey].name;
        hexNum = hexagramsMapping[baseKey].number;
        const baseJsonKey = Object.keys(typeof guaData!=="undefined"?guaData:{}).find(k=>k.startsWith(String(hexNum).padStart(2,'0')));
        if(baseJsonKey && guaData[baseJsonKey]) {
          hexText = guaData[baseJsonKey]['å¦è¾­'] || '';
        }
      }
      return {name: hexName, number: hexNum, text: hexText, key: baseKey};
    }
  </script>
</body>
</html> 